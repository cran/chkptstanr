<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>checkpointing: brms</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">checkpointing: brms</h1>



<p>The following examples walk through using <strong>chkptstanr</strong>
with the popular <code>R</code> package <a href="https://paul-buerkner.github.io/brms/"><strong>brms</strong></a>.</p>
<p>The basic idea is to (1) generate the <a href="https://mc-stan.org/users/interfaces/rstan"><strong>Stan</strong></a>
code with <strong>brms</strong>, (2) fit the model with <a href="https://mc-stan.org/cmdstanr/"><strong>cmdstanr</strong></a> (with
the desired number of checkpoints), and then (3) return a
<code>brmsfit</code> object. This is all done internally, so the
workflow is very similar to using <strong>brms</strong>.</p>
<div id="packages" class="section level2">
<h2>Packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chkptstanr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
</div>
<div id="example-1-no-stopping" class="section level1">
<h1>Example 1: No Stopping</h1>
<div id="storage" class="section level2">
<h2>Storage</h2>
<p>The initial overhead is to create a folder that will store the
checkpoints, i.e.,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">create_folder</span>(<span class="at">folder_name  =</span> <span class="st">&quot;chkpt_folder_m1&quot;</span>)</span></code></pre></div>
<p>which contains several additional folders (details can be found in
the documentation).</p>
</div>
<div id="brmsformula" class="section level2">
<h2><code>brmsformula</code></h2>
<p>In this example, we create a <code>brmsformula</code> object using
<code>bf()</code>. Note that for this model, we could also use formula
argument (e.g., <code>formula = y ~ x</code>), but in our experiences
<code>bf()</code> is more general.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>bf_m1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase  <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> patient),</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>())</span></code></pre></div>
</div>
<div id="model-fitting" class="section level2">
<h2>Model Fitting</h2>
<p>The next step is to use <code>chkpt_brms()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fit_m1 <span class="ot">&lt;-</span> <span class="fu">chkpt_brms</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> bf_m1,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> path,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_per_chkpt =</span> <span class="dv">250</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>When running the above, a custom progress bar is printed that
includes information about the checkpoints.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Compiling Stan program...</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Initial Warmup (Typical Set)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 1 / 8; Iteration: 250 / 2000 (warmup)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 2 / 8; Iteration: 500 / 2000 (warmup)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 3 / 8; Iteration: 750 / 2000 (warmup)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 4 / 8; Iteration: 1000 / 2000 (warmup)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 5 / 8; Iteration: 1250 / 2000 (sample)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 6 / 8; Iteration: 1500 / 2000 (sample)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 7 / 8; Iteration: 1750 / 2000 (sample)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 8 / 8; Iteration: 2000 / 2000 (sample)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Checkpointing complete</span></span></code></pre></div>
<p>In this case, checkpointing is complete.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p><code>fit_m1</code> is a <code>brmsfit</code> object which means that
all of the functionality of <strong>brms</strong> can still be used.</p>
<p>Here is the summary output:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fit_m1</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Family: poisson </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Links: mu = log </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Formula: count ~ zAge + zBase + (1 | patient) </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Data: data (Number of observations: 236) </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Draws: 2 chains, each with iter = 1000; warmup = 0; thin = 1;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          total post-warmup draws = 2000</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Group-Level Effects: </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ~patient (Number of levels: 59) </span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sd(Intercept)     0.58      0.07     0.46     0.73 1.00      349      682</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Population-Level Effects: </span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Intercept     1.63      0.08     1.46     1.78 1.01      406      898</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; zAge          0.11      0.09    -0.06     0.27 1.00      463      796</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; zBase         0.73      0.08     0.58     0.89 1.00      613      814</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
</div>
<div id="posterior-predictive-check" class="section level2">
<h2>Posterior Predictive Check</h2>
<p>Of course, due to being a <code>brmsfit</code> object, it is seamless
perform a posterior predictive check.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit_m1)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /></p>
</div>
</div>
<div id="example-2-start-stop-start-etc." class="section level1">
<h1>Example 2: Start, Stop, Start, etc.</h1>
<p>The previous example could just as well be fitted directly with
<strong>brms</strong>. This is because the MCMC sampler was not stopped
during model fitting.</p>
<p>In the following example, we illustrate the usefulness of
<strong>chkptstanr</strong>, i.e., the ability to stop the MCMC sampler
at will, and then pick right back up where the MCMC sampler left
off.</p>
<div id="storage-1" class="section level2">
<h2>Storage</h2>
<p>The initial overhead is to create a folder that will store the
checkpoints, i.e.,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">create_folder</span>(<span class="at">folder_name  =</span> <span class="st">&quot;chkpt_folder_m2&quot;</span>)</span></code></pre></div>
</div>
<div id="model-fitting-1" class="section level2">
<h2>Model Fitting</h2>
<p>This model is mostly the same as above. The one difference is that it
does not include varying (“random”) intercepts.</p>
<div id="start-and-stop-two-checkpoints" class="section level3">
<h3>Start and Stop: Two Checkpoints</h3>
<p>To illustrate checkpointing, the following was stopped after 2
checkpoints.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit_m2 <span class="ot">&lt;-</span> <span class="fu">chkpt_brms</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>()),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> path,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_per_chkpt =</span> <span class="dv">250</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Compiling Stan program...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Initial Warmup (Typical Set)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 1 / 8; Iteration: 250 / 2000 (warmup)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 2 / 8; Iteration: 500 / 2000 (warmup)</span></span></code></pre></div>
<p>Note this was stopped by clicking on the red button aptly titled stop
(in the console).</p>
<p>This is but one use case, for example, needing to do something else
but not wanting to loose the progress (including the compiled model).
Another use case is scheduling, such that the model samples during
certain times until completion.</p>
</div>
<div id="start-and-stop-two-more-checkpoints" class="section level3">
<h3>Start and Stop: Two More Checkpoints</h3>
<p>Now pick up at the next checkpoint. This is accomplished by simply
running the same code.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit_m2 <span class="ot">&lt;-</span> <span class="fu">chkpt_brms</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">poisson</span>()),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> path,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_per_chkpt =</span> <span class="dv">250</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sampling next checkpoint</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 3 / 8; Iteration: 750 / 2000 (warmup)</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 4 / 8; Iteration: 1000 / 2000 (warmup)</span></span></code></pre></div>
<p>Notice it picks up at right where it left off (stopped after 2
checkpoints)</p>
</div>
<div id="start-finish-checkpointing" class="section level3">
<h3>Start: Finish Checkpointing</h3>
<p>Now let us finish the remaining 4 checkpoints.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit_m2 <span class="ot">&lt;-</span> <span class="fu">chkpt_brms</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">poisson</span>()),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> path,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_per_chkpt =</span> <span class="dv">250</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sampling next checkpoint</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 5 / 8; Iteration: 1250 / 2000 (sample)</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 6 / 8; Iteration: 1500 / 2000 (sample)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 7 / 8; Iteration: 1750 / 2000 (sample)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chkpt: 8 / 8; Iteration: 2000 / 2000 (sample)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Checkpointing complete</span></span></code></pre></div>
<p>If we trying running the model again, we get the following
message:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit_m2 <span class="ot">&lt;-</span> <span class="fu">chkpt_brms</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">poisson</span>()),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> path,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_per_chkpt =</span> <span class="dv">250</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sampling next checkpoint</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Checkpointing complete</span></span></code></pre></div>
<p>Note that the arguments need to be exactly the same when
restarting.</p>
<p>There is a check for <code>data</code>, <code>formula</code>,
<code>iter_per_chkpt</code>, etc., and if they have been changed, this
will produce an error (with an informative warning message).</p>
</div>
</div>
<div id="diagnostics" class="section level2">
<h2>Diagnostics</h2>
<p>Some diagnostic information is provided in the summary output.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit_m2</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Family: poisson </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Links: mu = log </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Formula: count ~ zAge + zBase </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Data: data (Number of observations: 236) </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Draws: 2 chains, each with iter = 1000; warmup = 0; thin = 1;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          total post-warmup draws = 2000</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Population-Level Effects: </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Intercept     1.84      0.03     1.78     1.89 1.00     1037     1009</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; zAge          0.16      0.02     0.11     0.21 1.00     1192      945</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; zBase         0.60      0.01     0.58     0.63 1.00     1463     1559</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>These diagnostics indicate the inference converged.</p>
</div>
<div id="more-diagnostics" class="section level2">
<h2>More Diagnostics</h2>
<p><strong>cmdstanr</strong> works with several packages in the
<strong>Stan</strong> ecosystem, including <a href="https://mc-stan.org/posterior/"><strong>posterior</strong></a> and
<a href="https://mc-stan.org/bayesplot/"><strong>bayesplot</strong></a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draws for bayesplot</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_array</span>(fit_m2)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># trace plot</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(<span class="at">x =</span> draws, <span class="at">pars =</span> <span class="st">&quot;b_zAge&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">250</span>), </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.25</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /></p>
<p>This vertical lines are placed at each checkpoint.</p>
</div>
<div id="model-comparison" class="section level2">
<h2>Model Comparison</h2>
<p>These models can then be compared with approximate leave-one-out
cross-validation (via the <code>R</code> package <a href="http://mc-stan.org/loo/index.html"><strong>loo</strong></a>).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(<span class="fu">loo</span>(fit_m1), <span class="fu">loo</span>(fit_m2))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       elpd_diff se_diff</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; fit_m1    0.0       0.0 </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; fit_m2 -203.6      65.4 </span></span></code></pre></div>
</div>
</div>
<div id="compare-to-brm" class="section level1">
<h1>Compare to <code>brm</code></h1>
<p>For a sanity check, here is <code>fit_m2</code> fitted with
<strong>brms</strong>. The estimates should be (basically) the same.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit_brms <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">poisson</span>()),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>fit_brms</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Family: poisson </span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Links: mu = log </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Formula: count ~ zAge + zBase </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Data: epilepsy (Number of observations: 236) </span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          total post-warmup draws = 2000</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Population-Level Effects: </span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Intercept     1.84      0.03     1.78     1.89 1.00     1247     1310</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; zAge          0.16      0.02     0.11     0.21 1.00     1226     1191</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; zBase         0.60      0.01     0.57     0.63 1.00     1107     1229</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>The results for the parameter estimates and diagnostics are very
similar (as expected).</p>
</div>
<div id="example-3-user-defined-priors" class="section level1">
<h1>Example 3: User Defined Priors</h1>
<p><code>chkpt_brms()</code> includes <code>...</code> which passes any
number of (valid) arguments to <code>brm()</code>. Accordingly, priors
can be specified as though <code>brm()</code> was used.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">create_folder</span>(<span class="at">folder_name =</span> <span class="st">&quot;chkpt_folder_m3&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># priors</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>bprior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">1</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">2</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>, <span class="at">coef =</span> <span class="st">&quot;zBase&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">constant</span>(<span class="fl">0.5</span>), <span class="at">class =</span> <span class="st">&quot;sd&quot;</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>fit_m3 <span class="ot">&lt;-</span> <span class="fu">chkpt_brms</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(<span class="at">formula =</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase  <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> patient),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">family =</span> <span class="fu">poisson</span>()),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> bprior,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> epilepsy,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> path,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_per_chkpt =</span> <span class="dv">250</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">brmsfit =</span> <span class="cn">TRUE</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><code>prior_summary()</code> can be used to confirm that the priors
found their way into the model correctly, i.e.,</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(fit_m3)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   prior     class      coef   group resp dpar nlpar bound       source</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             constant(1)         b                                                 user</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             constant(1)         b      zAge                               (vectorized)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             constant(2)         b     zBase                                       user</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  student_t(3, 1.4, 2.5) Intercept                                              default</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           constant(0.5)        sd                                                 user</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           constant(0.5)        sd           patient                       (vectorized)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           constant(0.5)        sd Intercept patient                       (vectorized)</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
